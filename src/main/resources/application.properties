############################################################
# SERVER
############################################################
server.port=8080

############################################################
# LOGGING (DEBUG during development)
############################################################
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.security.web=DEBUG
logging.level.org.springframework.web.client=DEBUG
logging.level.org.springframework.http.client=DEBUG
logging.level.com.abernathy.medilabogateway.controller=INFO

############################################################
# JWT CONFIGURATION
# Gateway will issue & validate JWT
############################################################
jwt.secret=change-me-please-very-secret-and-long
jwt.issuer=gateway.example
jwt.ttlSeconds=1800

############################################################
# SESSION (optional but recommended)
# Session cookie name = JSESSIONID (default, but explicit OK)
############################################################
server.servlet.session.cookie.name=JSESSIONID
server.servlet.session.timeout=1800

############################################################
# SPRING CLOUD GATEWAY (SERVLET / WebMVC MODE)
############################################################
# ----------------- FRONTEND ROUTE (http://localhost:8082) ----------
spring.cloud.gateway.server.webmvc.routes[0].id=frontend
#spring.cloud.gateway.server.webmvc.routes[0].uri=http://medilaboui:8082
spring.cloud.gateway.server.webmvc.routes[0].uri=http://localhost:8082
spring.cloud.gateway.server.webmvc.routes[0].predicates[0]=Path=/patients/**  
# Make sure browser knows original host
spring.cloud.gateway.server.webmvc.routes[0].filters[0]=AddRequestHeader=X-Forwarded-Host,localhost:8080
# Optional: simplify URL (remove /patients prefix if necessary)
# spring.cloud.gateway.server.webmvc.routes[0].filters[1]=RewritePath=/patients/(?<segment>.*), /${segment}



# ---------- PATIENTS API (8081) ----------
spring.cloud.gateway.server.webmvc.routes[1].id=patients-api
spring.cloud.gateway.server.webmvc.routes[1].uri=http://localhost:8081
#spring.cloud.gateway.server.webmvc.routes[1].predicates[0]=Path=/api/proxy/patients/**
# Rewrite path: /api/proxy/patients/** -> /patients/**
#spring.cloud.gateway.server.webmvc.routes[1].filters[0]=RewritePath=/api/proxy/patients/(?<segment>.*), /patients/${segment}
#spring.cloud.gateway.server.webmvc.routes[1].filters[1]=AddRequestParameter=id, #{request.query.id}  # <<< ensures PUT/DELETE sees id

spring.cloud.gateway.server.webmvc.routes[1].predicates[0]=Path=/api/proxy/patients
spring.cloud.gateway.server.webmvc.routes[1].filters[0]=RewritePath=/api/proxy/patients, /patients


# ---------- MEDICAL NOTES API (8083) ----------
spring.cloud.gateway.server.webmvc.routes[2].id=notes-api
spring.cloud.gateway.server.webmvc.routes[2].uri=http://localhost:8083
spring.cloud.gateway.server.webmvc.routes[2].predicates[0]=Path=/api/proxy/notes/** 
# Rewrite path: /api/proxy/notes/** -> /api/notes/**
spring.cloud.gateway.server.webmvc.routes[2].filters[0]=RewritePath=/api/proxy/notes/(?<segment>.*), /api/notes/${segment}
# Add request parameter so patientId is preserved for POST/PUT
spring.cloud.gateway.server.webmvc.routes[2].filters[1]=AddRequestParameter=patientId, #{request.query.patientId}

# BACKEND ROUTE (Risk Assessment API)
spring.cloud.gateway.server.webmvc.routes[3].id=api-risk
spring.cloud.gateway.server.webmvc.routes[3].uri=http://localhost:8084
spring.cloud.gateway.server.webmvc.routes[3].predicates[0]=Path=/api/proxy/risk/**
spring.cloud.gateway.server.webmvc.routes[3].filters[0]=RewritePath=/api/proxy/risk/(?<segment>.*), /risk/${segment}
#spring.cloud.gateway.server.webmvc.routes[3].filters[1]=AddRequestHeader=Cookie, #{request.headers['Cookie']}



# BACKEND BASE URL
routing.backendBaseUrl=http://localhost:8080
patients.url=http://localhost:8081
notes.url=http://localhost:8083
risk.url=http://localhost:8084
frontend.url=http://localhost:8082

## All backend calls go via gateway itself (8080)
#routing.backendBaseUrl=http://localhost:8080
#patients.url=http://localhost:8080
#notes.url=http://localhost:8080
#risk.url=http://localhost:8080
#frontend.url=http://localhost:8080
